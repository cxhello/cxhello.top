---
title: 'System Design Patterns in Practice: General Factory + Abstract Strategy'
date: '2025-06-29'
tags: ['Design Patterns']
summary: 'System Design Patterns in Practice: General Factory + Abstract Strategy.'
images: ['/static/images/banners/photo-1552238979-402eb7a9258c.jpg']
authors: ['default']
---

å…¶å®ä¸€ç›´ä»¥æ¥åœ¨é¡¹ç›®å¼€å‘ä¸­è®¾è®¡æ¨¡å¼åº”ç”¨çš„æ¯”è¾ƒå°‘ï¼Œæ›´å¤šçš„æ˜¯çœ‹ä¸€äº›æ¡†æ¶ç»„ä»¶çš„åº•å±‚å®ç°ã€‚åƒ Spring ä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ BeanFactory & ApplicationContext åˆ›å»º Beanå¯¹è±¡ã€Spring Bean é»˜è®¤çš„å•ä¾‹æ¨¡å¼ã€AOP ä¸­çš„ä»£ç†æ¨¡å¼ã€Spring Security çš„è´£ä»»é“¾æ¨¡å¼ç­‰ç­‰ã€‚æœ€è¿‘æ¥è§¦äº†ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œåœ¨æ¢³ç†ä»£ç ä»¥åŠå¼€å‘çš„è¿‡ç¨‹ä¸­å‘ç°ç›¸å…³çš„å®ç°å¯ä»¥åœ¨å¾ˆå¤šåœºæ™¯éƒ½å¯ä»¥å¾—åˆ°è¿ç”¨ã€‚

æˆ‘å°†é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒç”Ÿæ´»åŒ–çš„ç¤ºä¾‹ï¼Œå’–å•¡åº—ç‚¹é¤ç³»ç»Ÿï¼Œæ¥è¯´æ˜è¿™ç§è®¾è®¡æ¨¡å¼çš„å¼ºå¤§ä¹‹å¤„ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬æ ¹æ®é¡¾å®¢çš„ä¼šå‘˜ç­‰çº§ï¼ˆæ™®é€šã€é“¶å¡ã€é‡‘å¡ï¼‰ä»¥åŠé¡¾å®¢çš„è®¢å•ç±»å‹ï¼ˆå’–å•¡ã€èŒ¶ã€ç”œç‚¹ï¼‰æ¥æä¾›ä¸åŒçš„æœåŠ¡å’Œä¼˜æƒ ã€‚

è®¾è®¡æ€è·¯å¤§æ¦‚å¦‚ä¸‹ï¼š

1. åŸºç¡€ç»„ä»¶ï¼šè¯·æ±‚å‚æ•°ï¼ˆBaseRequestï¼‰ã€é€šç”¨å·¥å‚æ¥å£`ï¼ˆCommonFactoryService<T>ï¼‰`ã€ç­–ç•¥é€‰æ‹©å™¨ï¼ˆCommonStrategyBeanSelectorï¼‰ï¼›
2. ä¸šåŠ¡é¢†åŸŸ
   1. ä¼šå‘˜æœåŠ¡ï¼ˆAbstractCustomerServiceï¼‰ï¼šæ ¹æ®ä¼šå‘˜ç­‰çº§æä¾›ä¸åŒçš„æœåŠ¡ï¼ˆæ™®é€šã€ä¼šå‘˜ã€VIPï¼‰ï¼›
   2. è®¢å•æœåŠ¡ï¼ˆAbstractOrderServiceï¼‰ï¼šå¤„ç†ä¸åŒç±»å‹çš„è®¢å•ï¼ˆæ™®é€šè®¢å•ã€ä¼šå‘˜è®¢å•ã€VIPè®¢å•ï¼‰ï¼›
   3. æ”¯ä»˜æœåŠ¡ï¼ˆAbstractPaymentServiceï¼‰ï¼šæ ¹æ®è®¢å•ç±»å‹å’Œä¼šå‘˜ç­‰çº§æä¾›ä¸åŒçš„æ”¯ä»˜æ–¹å¼ï¼ˆæ™®é€šã€ä¼šå‘˜ã€VIPï¼‰

æ¯ä¸ªä¸šåŠ¡é¢†åŸŸéƒ½æœ‰è‡ªå·±çš„å·¥å‚ç±»ä»¥åŠå¯¹æŠ½è±¡åŸºç±»ã€‚å…·ä½“åˆ°ä¸šåŠ¡é€»è¾‘å±‚é¢ï¼Œå°±å¯ä»¥ç»§æ‰¿å¯¹åº”ä¸šåŠ¡é¢†åŸŸçš„æŠ½è±¡åŸºç±»ï¼Œç„¶åå®ç°è‡ªå·±çš„å†…éƒ¨é€»è¾‘ã€‚ä¹Ÿå¯ä»¥å¤ç”¨æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç”»äº†å‡ ä¸ªå›¾ã€‚

## ä¸šåŠ¡æ¶æ„å›¾

![](https://cxhello.oss-cn-beijing.aliyuncs.com/image/20250627220938145.png)

## ç±»å›¾

![](https://cxhello.oss-cn-beijing.aliyuncs.com/image/20250628000957046.png)

## ç¤ºä¾‹

### åŸºç¡€ç»„ä»¶

```java
package top.cxhello.coffee.request;

import lombok.Getter;
import lombok.Setter;

/**
 * åŸºç¡€è¯·æ±‚
 * @author cxhello
 * @date 2025/6/27
 */
@Getter
@Setter
public class BaseRequest {

    /**
     * ç”¨æˆ·ç±»å‹ REGULARã€MEMBERã€VIP
     */
    private String customerType;

    /**
     * è®¢å•ç±»å‹ COFFEEã€TEAã€DESSERTã€COMBO
     */
    private String orderType;

    /**
     * æ”¯ä»˜æ–¹å¼ Wechatã€Alipayã€Points
     */
    private String paymentMethod;

    /**
     *
     */
    private int quantity;

    /**
     *
     */
    private double price;

}
```

```java
package top.cxhello.coffee.factory;

import top.cxhello.coffee.request.BaseRequest;

/**
 * é€šç”¨å·¥å‚æ¥å£
 * @author cxhello
 * @date 2025/6/27
 */
public interface CommonFactoryService<T> {

    /**
     * è·å–æœåŠ¡ç±»å‹
     * @param baseRequest
     * @return
     */
    T getService(BaseRequest baseRequest);
}

```

```java
package top.cxhello.coffee.strategy;

import jakarta.annotation.Resource;
import org.springframework.context.ApplicationContext;
import org.springframework.stereotype.Component;
import top.cxhello.coffee.request.BaseRequest;

/**
 * ç­–ç•¥é€‰æ‹©å™¨
 * @author cxhello
 * @date 2025/6/27
 */
@Component
public class CommonStrategyBeanSelector {

    @Resource
    private ApplicationContext context;

    public <T> T getService(BaseRequest baseRequest, String pattern) {
        String suffix = determineSuffix(baseRequest);
        String beanName = String.format(pattern, suffix);
        return (T) context.getBean(beanName);
    }

    private String determineSuffix(BaseRequest baseRequest) {
        // æ ¹æ®é¡¾å®¢ç±»å‹å’Œè®¢å•ç±»å‹ç¡®å®šç­–ç•¥
        if ("VIP".equals(baseRequest.getCustomerType())) {
            return "vip";
        } else if ("MEMBER".equals(baseRequest.getCustomerType())) {
            return "member";
        }
        return "regular";
    }

}
```

### ä¼šå‘˜ä¸šåŠ¡é¢†åŸŸ

```java
package top.cxhello.coffee.service;

/**
 * ä¼šå‘˜æœåŠ¡
 * @author cxhello
 * @date 2025/6/27
 */
public interface CustomerService {
}
```

```java
package top.cxhello.coffee.service.base;

import org.springframework.stereotype.Service;
import top.cxhello.coffee.request.BaseRequest;
import top.cxhello.coffee.service.CustomerService;

/**
 * ä¼šå‘˜æŠ½è±¡æœåŠ¡
 * @author cxhello
 * @date 2025/6/27
 */
@Service
public abstract class AbstractCustomerService implements CustomerService {

    public abstract String provideService(BaseRequest baseRequest);

    // å…¬å…±æ–¹æ³•
    protected String greetCustomer(String customerType) {
        return String.format("ğŸ‘‹ æ¬¢è¿ %s å…‰ä¸´å’–å•¡åº—! </br>", customerType);
    }

}
```

```java
package top.cxhello.coffee.service.impl;

import org.springframework.stereotype.Service;
import top.cxhello.coffee.request.BaseRequest;
import top.cxhello.coffee.service.base.AbstractCustomerService;

/**
 * æ™®é€šç”¨æˆ·ç­–ç•¥
 * @author cxhello
 * @date 2025/6/27
 */
@Service
public class RegularCustomerService extends AbstractCustomerService {

    @Override
    public String provideService(BaseRequest baseRequest) {
        return greetCustomer("æ™®é€šé¡¾å®¢") + " </br>" +
                "ğŸ“‹ æä¾›æ ‡å‡†æœåŠ¡" + " </br>" +
                "æ™®é€šå®¢æˆ·æœåŠ¡å®Œæˆ </br>";
    }

}
```

```java
package top.cxhello.coffee.service.impl;

import org.springframework.stereotype.Service;
import top.cxhello.coffee.request.BaseRequest;
import top.cxhello.coffee.service.base.AbstractCustomerService;

/**
 * ä¼šå‘˜ç”¨æˆ·å¤„ç†ç­–ç•¥
 * @author cxhello
 * @date 2025/6/27
 */
@Service
public class MemberCustomerService extends AbstractCustomerService {

    @Override
    public String provideService(BaseRequest baseRequest) {
        return greetCustomer("ä¼šå‘˜") + " </br>" +
                "ğŸ“± æ‰«ç ç™»è®°ä¼šå‘˜" + " </br>" +
                "ğŸ¯ æ¨èä¼šå‘˜ä¸“å±ä¼˜æƒ " + " </br>" +
                "ä¼šå‘˜æœåŠ¡å®Œæˆ  </br>";
    }

}
```

```java
package top.cxhello.coffee.service.impl;

import org.springframework.stereotype.Service;
import top.cxhello.coffee.request.BaseRequest;
import top.cxhello.coffee.service.base.AbstractCustomerService;

/**
 * VIPç”¨æˆ·å¤„ç†ç­–ç•¥
 * @author cxhello
 * @date 2025/6/27
 */
@Service
public class VipCustomerService extends AbstractCustomerService {

    @Override
    public String provideService(BaseRequest baseRequest) {
        return greetCustomer("VIP") + " </br>" +
                "ğŸ‘” ä¸“å±å®¢æœæ¥å¾…" + " </br>" +
                "ğŸ“– æä¾›VIPä¸“å±èœå•" + " </br>" +
                "VIPæœåŠ¡å®Œæˆ  </br>";
    }

}
```

```java
package top.cxhello.coffee.factory.impl;

import jakarta.annotation.Resource;
import org.springframework.stereotype.Service;
import top.cxhello.coffee.factory.CommonFactoryService;
import top.cxhello.coffee.request.BaseRequest;
import top.cxhello.coffee.service.base.AbstractCustomerService;
import top.cxhello.coffee.strategy.CommonStrategyBeanSelector;

/**
 * ç”¨æˆ·å·¥å‚
 * @author cxhello
 * @date 2025/6/27
 */
@Service("customerFactoryService")
public class CustomerFactoryServiceImpl implements CommonFactoryService<AbstractCustomerService> {

    @Resource
    private CommonStrategyBeanSelector selector;

    @Override
    public AbstractCustomerService getService(BaseRequest baseRequest) {
        return selector.getService(baseRequest, "%sCustomerService");
    }

}
```

è®¢å•ä¸šåŠ¡é¢†åŸŸ&æ”¯ä»˜ä¸šåŠ¡é¢†åŸŸå¯å‚è€ƒå®Œæ•´ä»£ç 

### Controlleræ¥å£æµ‹è¯•

```java
package top.cxhello.coffee.controller;

import jakarta.annotation.Resource;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import top.cxhello.coffee.factory.CommonFactoryService;
import top.cxhello.coffee.request.BaseRequest;
import top.cxhello.coffee.service.base.AbstractCustomerService;
import top.cxhello.coffee.service.base.AbstractOrderService;
import top.cxhello.coffee.service.base.AbstractPaymentService;

/**
 * @author cxhello
 * @date 2025/6/27
 */
@RestController
public class TestController {

    @Resource(name = "customerFactoryService")
    private CommonFactoryService<AbstractCustomerService> customerFactoryService;

    @Resource(name = "orderFactoryService")
    private CommonFactoryService<AbstractOrderService> orderFactoryService;

    @Resource(name = "paymentFactoryService")
    private CommonFactoryService<AbstractPaymentService> paymentFactoryService;

    @GetMapping("/test1")
    public String test1() {
        BaseRequest baseRequest = new BaseRequest();
        baseRequest.setCustomerType("REGULAR");
        baseRequest.setOrderType("COFFEE");
        baseRequest.setPaymentMethod("CASH");
        baseRequest.setQuantity(1);
        baseRequest.setPrice(30.0);
        StringBuilder result = new StringBuilder();

        result.append("====== è®¢å•å¤„ç†å¼€å§‹ ====== </br>");
        AbstractCustomerService abstractCustomerService = customerFactoryService.getService(baseRequest);
        AbstractOrderService abstractOrderService = orderFactoryService.getService(baseRequest);
        AbstractPaymentService abstractPaymentService = paymentFactoryService.getService(baseRequest);

        result.append(abstractCustomerService.provideService(baseRequest)).append("\n");
        result.append(abstractOrderService.prepareOrder(baseRequest)).append("\n");
        result.append(abstractPaymentService.pay(baseRequest)).append("\n");

        result.append("====== è®¢å•å¤„ç†å®Œæˆ ====== </br>");
        return result.toString();
    }

    @GetMapping("/test2")
    public String test2() {
        BaseRequest baseRequest = new BaseRequest();
        baseRequest.setCustomerType("MEMBER");
        baseRequest.setOrderType("COMBO");
        baseRequest.setPaymentMethod("MOBILE");
        baseRequest.setQuantity(2);
        baseRequest.setPrice(60.0);
        StringBuilder result = new StringBuilder();

        result.append("====== è®¢å•å¤„ç†å¼€å§‹ ====== </br>");
        AbstractCustomerService abstractCustomerService = customerFactoryService.getService(baseRequest);
        AbstractOrderService abstractOrderService = orderFactoryService.getService(baseRequest);
        AbstractPaymentService abstractPaymentService = paymentFactoryService.getService(baseRequest);

        result.append(abstractCustomerService.provideService(baseRequest)).append("\n");
        result.append(abstractOrderService.prepareOrder(baseRequest)).append("\n");
        result.append(abstractPaymentService.pay(baseRequest)).append("\n");

        result.append("====== è®¢å•å¤„ç†å®Œæˆ ====== </br>");
        return result.toString();
    }

    @GetMapping("/test3")
    public String test3() {
        BaseRequest baseRequest = new BaseRequest();
        baseRequest.setCustomerType("VIP");
        baseRequest.setOrderType("DESSERT");
        baseRequest.setPaymentMethod("CARD");
        baseRequest.setQuantity(1);
        baseRequest.setPrice(40.0);
        StringBuilder result = new StringBuilder();

        result.append("====== è®¢å•å¤„ç†å¼€å§‹ ====== </br>");
        AbstractCustomerService abstractCustomerService = customerFactoryService.getService(baseRequest);
        AbstractOrderService abstractOrderService = orderFactoryService.getService(baseRequest);
        AbstractPaymentService abstractPaymentService = paymentFactoryService.getService(baseRequest);

        result.append(abstractCustomerService.provideService(baseRequest)).append("\n");
        result.append(abstractOrderService.prepareOrder(baseRequest)).append("\n");
        result.append(abstractPaymentService.pay(baseRequest)).append("\n");

        result.append("====== è®¢å•å¤„ç†å®Œæˆ ====== </br>");
        return result.toString();
    }

}
```

è¯¥è®¾è®¡æ¨¡å¼å…¶å®ä¹Ÿå¯ä»¥æ‰©å±•åˆ°å…¶ä»–ç”Ÿæ´»åœºæ™¯ï¼Œæ¯”å¦‚è¯´ï¼šé¤å…è®¢åº§ç³»ç»Ÿã€ç”µå½±é™¢å”®ç¥¨ç³»ç»Ÿã€å¥èº«æˆ¿ç®¡ç†ç³»ç»Ÿã€è¿˜æœ‰ä¸€äº› SaaS å¹³å°ã€‚

å®Œæ•´ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

> https://github.com/cxhello/coffee-shop-design-patterns
